<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å‹˜å®šç§‘ç›® RPG + è‹¦æ‰‹æ”»ç•¥</title>
  <style>
    :root{
      --border:#ddd; --border2:#ccc; --text-muted:#666;
      --ok:#0a7; --ng:#c33; --radius:14px;
      /* è‰²åˆ†ã‘ */
      --asset-bg: #eef6ff; --asset-bd:#b7d7ff;
      --liab-bg:  #fff2f2; --liab-bd:#ffc2c2;
      --equity-bg:#f3efff; --equity-bd:#d2c6ff;
      --exp-bg:   #fff7e6; --exp-bd:#ffd08a;
      --rev-bg:   #effff4; --rev-bd:#b7f0c6;
      --other-bg: #f5f5f5; --other-bd:#d9d9d9;
    }

    body { font-family: sans-serif; max-width: 920px; margin: 24px auto; padding: 0 12px; background-color: #f9f9f9; }
    .card { border: 1px solid var(--border); border-radius: var(--radius); padding: 20px; background: #fff; box-shadow: 0 4px 12px rgba(0,0,0,0.05); position: relative; }
    .muted { color: var(--text-muted); font-size: 14px; }
    .big { font-size: 30px; font-weight: 800; margin: 10px 0 14px; line-height:1.2; }
    .ok { color: var(--ok); font-weight: 900; }
    .ng { color: var(--ng); font-weight: 900; }
    
    .toolbar { display:flex; flex-wrap:wrap; gap:10px 14px; align-items:center; margin: 12px 0 8px; }
    label { user-select:none; cursor: pointer; }
    select { padding: 8px 10px; border-radius: 8px; border: 1px solid var(--border2); background: #fff; }
    input[type="checkbox"] { transform: scale(1.15); margin-right: 4px; }
    button { border-radius: 14px; border: 1px solid var(--border2); background: #fff; cursor: pointer; transition: all 0.2s; }
    button:hover { opacity: .92; transform: translateY(-1px); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .actionBtn { padding: 10px 16px; font-weight: 700; color: #444; }

    /* è‹¦æ‰‹ãƒªã‚¹ãƒˆãƒœã‚¿ãƒ³ */
    #mistakeBtn { color: #c33; border-color: #fcc; background: #fff5f5; font-weight: bold; display: none; }
    
    .grid { display: grid; gap: 10px; margin-top: 16px; }
    @media (max-width: 520px){ .grid { grid-template-columns: repeat(2, minmax(0, 1fr)); } }
    @media (min-width: 521px) and (max-width: 860px){ .grid { grid-template-columns: repeat(3, minmax(0, 1fr)); } }
    @media (min-width: 861px){ .grid { grid-template-columns: repeat(4, minmax(0, 1fr)); } }
    
    .typeBtn{ padding: 16px 10px; min-height: 60px; font-size: 16px; font-weight: 800; line-height: 1.2; }
    .btn-asset { background: var(--asset-bg); border-color: var(--asset-bd); color: #004488; }
    .btn-liab  { background: var(--liab-bg);  border-color: var(--liab-bd);  color: #880000; }
    .btn-equity{ background: var(--equity-bg);border-color: var(--equity-bd);color: #330088; }
    .btn-exp   { background: var(--exp-bg);   border-color: var(--exp-bd);   color: #884400; }
    .btn-rev   { background: var(--rev-bg);   border-color: var(--rev-bd);   color: #006622; }
    .btn-other { background: var(--other-bg); border-color: var(--other-bd); color: #444; }

    .summary { margin-top: 20px; padding-top:10px; border-top: 1px solid #eee; display:flex; flex-wrap:wrap; gap:10px 16px; align-items:center; }
    .legend { display:flex; flex-wrap:wrap; gap:8px; margin-top: 12px; }
    .tag { font-size:11px; padding:3px 8px; border-radius:999px; border:1px solid var(--border); user-select: none; }
    .tag.asset { background: var(--asset-bg); border-color: var(--asset-bd); }
    .tag.liab  { background: var(--liab-bg);  border-color: var(--liab-bd); }
    .tag.equity{ background: var(--equity-bg);border-color: var(--equity-bd);}
    .tag.exp   { background: var(--exp-bg);   border-color: var(--exp-bd); }
    .tag.rev   { background: var(--rev-bg);   border-color: var(--rev-bd); }
    .tag.other { background: var(--other-bg); border-color: var(--other-bd); }

    /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ï¼ˆå‹•ãèƒŒæ™¯ï¼‰ */
    .status-bar { 
      display: flex; align-items: center; gap: 16px; 
      margin-bottom: 20px; padding: 16px; border-radius: 12px;
      border: 2px solid #333;
      background: linear-gradient(270deg, #ffe6e6, #e6f0ff, #e6ffe6, #fffde6);
      background-size: 800% 800%;
      animation: bgAnimation 15s ease infinite;
    }
    @keyframes bgAnimation { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }

    .char-icon { font-size: 48px; line-height: 1; animation: bounce 2s infinite; cursor: default; }
    .char-info { flex: 1; }
    .char-name { font-weight: 800; font-size: 18px; color: #333; margin-bottom: 4px; }
    .char-next { font-size: 12px; color: #444; font-weight: 600; }
    #playerName { font-size:16px; padding:6px; margin-bottom:6px; width:90%; border:2px solid #ccc; border-radius:6px; font-weight:bold; }
    #playerName:read-only { background-color: #eee; color: #555; border-color: #ddd; }
    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

    /* â˜… è‹¦æ‰‹ãƒªã‚¹ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« */
    #mistakeModal {
      display: none; position: fixed; top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.5); z-index: 100; padding: 20px; box-sizing: border-box;
      overflow-y: auto;
    }
    .modal-content {
      background: #fff; max-width: 600px; margin: 40px auto; padding: 24px;
      border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    }
    .mistake-item {
      display: flex; justify-content: space-between; align-items: center;
      padding: 10px; border-bottom: 1px solid #eee;
    }
    .mistake-item:last-child { border-bottom: none; }
    .m-name { font-weight: bold; font-size: 16px; }
    .m-ans { color: #0a7; font-size: 14px; margin-left: 10px; }
    .del-btn {
      font-size: 12px; padding: 4px 10px; border: 1px solid #ccc;
      background: #f0f0f0; border-radius: 4px; margin-left: auto;
    }

  </style>
</head>

<body>
  <div style="margin-bottom:10px;">
    <h2 style="margin:0;">å‹˜å®šç§‘ç›® RPG</h2>
    <span class="small">åå‰ã‚’å…¥åŠ›ã—ã¦ã‚¹ã‚¿ãƒ¼ãƒˆï¼é–“é•ãˆãŸã‚‰è‡ªå‹•ã§ãƒªã‚¹ãƒˆã«å…¥ã‚Šã¾ã™ã€‚</span>
  </div>

  <div class="card">
    <div class="status-bar">
      <div class="char-icon" id="charIcon">ğŸ¥š</div>
      <div class="char-info">
        <input type="text" id="playerName" placeholder="åå‰ã‚’å…¥åŠ›(å¿…é ˆ)" onblur="lockNameTry()">
        <div class="char-name" id="charName">èª­ã¿è¾¼ã¿ä¸­...</div>
        <div class="char-next" id="charNext"></div>
      </div>
      <div style="text-align:right;">
        <div class="small">ç´¯è¨ˆæ­£è§£</div>
        <div style="font-weight:800; font-size:18px;"><span id="totalAccumulated">0</span>å•</div>
      </div>
    </div>

    <div id="quizArea">
      <div class="muted">æ¬¡ã®å‹˜å®šç§‘ç›®ã®ã€Œã‚¿ã‚¤ãƒ—ã€ã¯ï¼Ÿ</div>
      <div id="account" class="big">ã‚¹ã‚¿ãƒ¼ãƒˆï¼</div>
    </div>

    <div id="stageClear" style="display:none; text-align:center; padding: 24px 0;">
      <div class="title" style="font-size:20px; font-weight:bold;">ğŸ‰ 20å•çµ‚äº†ï¼</div>
      <div id="lapMsg" style="margin:10px 0;"></div>
      <button class="actionBtn" style="background:#333; color:#fff;" onclick="startNextLap()">æ¬¡ã®20å•ã¸ â–¶</button>
      <div style="margin-top:16px; color:#666;">
        ä»Šå›ã®æˆç¸¾ï¼šæ­£è§£ <span id="scCorrect">0</span> / <span id="scCount">0</span> å•
      </div>
    </div>

    <div class="toolbar">
      <label class="small"><input id="toggleOther" type="checkbox" checked> ãã®ä»–ã‚‚å«ã‚ã‚‹</label>
      <label class="small">
        <select id="typeFilter">
          <option value="__ALL__">ã™ã¹ã¦</option>
        </select>
      </label>
      
      <button id="mistakeBtn" class="actionBtn" onclick="openMistakeModal()">
        âš ï¸ è‹¦æ‰‹ãƒªã‚¹ãƒˆ (<span id="mistakeCount">0</span>)
      </button>

      <div style="flex:1;"></div>
      <button class="actionBtn" onclick="next()">ã‚¹ã‚­ãƒƒãƒ—</button>
      <button class="actionBtn" onclick="resetAllData()" style="color:#c33;">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <div class="legend">
      <span class="tag asset">è³‡ç”£</span><span class="tag liab">è² å‚µ</span><span class="tag equity">ç´”è³‡ç”£</span>
      <span class="tag exp">è²»ç”¨</span><span class="tag rev">åç›Š</span><span class="tag other">ãã®ä»–</span>
    </div>

    <div id="buttons" class="grid"></div>
    <p id="result" style="margin-top:16px; font-weight:700; min-height:1.5em;"></p>

    <div class="summary muted">
      <span>ä»Šå›ï¼š<span id="correct">0</span> / <span id="count">0</span> å•æ­£è§£</span>
      <span class="small" style="margin-left:auto;">(æ®‹ã‚Š: <span id="remain">0</span> | å‘¨å›: <span id="lap">0</span>)</span>
    </div>
  </div>

  <div id="mistakeModal">
    <div class="modal-content">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
        <h3 style="margin:0;">ğŸ“ è‹¦æ‰‹ãƒªã‚¹ãƒˆï¼ˆé–“é•ãˆãŸå•é¡Œï¼‰</h3>
        <button onclick="closeMistakeModal()" style="font-size:20px; border:none; background:none;">âœ•</button>
      </div>
      <p class="small muted">ã€Œå‰Šé™¤ã€ã‚’æŠ¼ã™ã¨ãƒªã‚¹ãƒˆã‹ã‚‰æ¶ˆãˆã¾ã™ã€‚</p>
      
      <div id="mistakeListContainer" style="max-height:300px; overflow-y:auto; border:1px solid #eee; border-radius:8px; padding:10px;">
        </div>
      
      <div style="margin-top:20px; text-align:center;">
        <button class="actionBtn" onclick="closeMistakeModal()">é–‰ã˜ã¦å­¦ç¿’ã«æˆ»ã‚‹</button>
      </div>
    </div>
  </div>

<script>
  // ãƒ‡ãƒ¼ã‚¿ï¼ˆç°¡ç•¥åŒ–ã®ãŸã‚å¤‰æ•°ã«æ ¼ç´ï¼‰
  const RAW_CSV_DATA = `account,type
ç¾é‡‘,æµå‹•è³‡ç”£
å°å£ç¾é‡‘,æµå‹•è³‡ç”£
å½“åº§é é‡‘,æµå‹•è³‡ç”£
å—å–æ‰‹å½¢,æµå‹•è³‡ç”£
å£²æ›é‡‘,æµå‹•è³‡ç”£
ç¹°è¶Šå•†å“,æµå‹•è³‡ç”£
è²¸å€’å¼•å½“é‡‘,æµå‹•è³‡ç”£
æ¶ˆè€—å“,æµå‹•è³‡ç”£
ä»®æ‰•é‡‘,æµå‹•è³‡ç”£
å‰æ‰•é‡‘,æµå‹•è³‡ç”£
å»ºç‰©,å›ºå®šè³‡ç”£
å‚™å“,å›ºå®šè³‡ç”£
è»Šä¸¡é‹æ¬å…·,å›ºå®šè³‡ç”£
åœŸåœ°,å›ºå®šè³‡ç”£
æ”¯æ‰•æ‰‹å½¢,æµå‹•è² å‚µ
è²·æ›é‡‘,æµå‹•è² å‚µ
å‰å—é‡‘,æµå‹•è² å‚µ
æœªæ‰•é‡‘,æµå‹•è² å‚µ
é ã‚Šé‡‘,æµå‹•è² å‚µ
å€Ÿå…¥é‡‘,æµå‹•è² å‚µ
è³‡æœ¬é‡‘,ç´”è³‡ç”£
ä»•å…¥,å–¶æ¥­è²»ç”¨
çµ¦æ–™,è²©å£²è²»ãŠã‚ˆã³ä¸€èˆ¬ç®¡ç†è²»
é€šä¿¡è²»,è²©å£²è²»ãŠã‚ˆã³ä¸€èˆ¬ç®¡ç†è²»
æ°´é“å…‰ç†±è²»,è²©å£²è²»ãŠã‚ˆã³ä¸€èˆ¬ç®¡ç†è²»
æ”¯æ‰•å®¶è³ƒ,è²©å£²è²»ãŠã‚ˆã³ä¸€èˆ¬ç®¡ç†è²»
æ”¯æ‰•åˆ©æ¯,å–¶æ¥­å¤–è²»ç”¨
å£²ä¸Š,å–¶æ¥­åç›Š
å—å–åˆ©æ¯,å–¶æ¥­å¤–åç›Š
å—å–é…å½“é‡‘,å–¶æ¥­å¤–åç›Š
æç›Š,ãã®ä»–`;

  const MAX_QUESTIONS = 20;
  const CHARACTERS = [
    { score: 0,    icon: 'ğŸ¥š', name: 'Lv.1 ç°¿è¨˜ã®ãŸã¾ã”' },
    { score: 20,   icon: 'ğŸ£', name: 'Lv.2 æ–°äººãƒ”ãƒ¨ãƒ”ãƒ¨' },
    { score: 50,   icon: 'ğŸ¥', name: 'Lv.3 ã‹ã‘ã ã—çµŒç†' },
    { score: 100,  icon: 'ğŸ¢', name: 'Lv.4 ã‚³ãƒ„ã‚³ãƒ„äº€ã•ã‚“' },
    { score: 180,  icon: 'ğŸ‡', name: 'Lv.5 ç–¾é¢¨ã®ä»•è¨³äºº' },
    { score: 280,  icon: 'ğŸ¦‰', name: 'Lv.6 è³¢è€…ã®çŸ¥æµ' },
    { score: 400,  icon: 'ğŸ†', name: 'Lv.7 æ±ºç®—ã®ç‹©äºº' },
    { score: 550,  icon: 'ğŸ¦', name: 'Lv.8 è²¡å‹™ã®ç‹' },
    { score: 750,  icon: 'ğŸ²', name: 'Lv.9 ä¼èª¬ã®ä¼šè¨ˆé¾' },
    { score: 1000, icon: 'ğŸ§š', name: 'Lv.10 ç°¿è¨˜ãƒã‚¹ã‚¿ãƒ¼' },
  ];

  let totalCorrectAccumulated = 0;
  let currentCharacter = CHARACTERS[0];
  let playerName = "";
  
  // â˜… è‹¦æ‰‹ãƒªã‚¹ãƒˆç”¨ã®å¤‰æ•°
  let mistakeList = [];

  const TYPE_ORDER = ['æµå‹•è³‡ç”£','å›ºå®šè³‡ç”£','æµå‹•è² å‚µ','å›ºå®šè² å‚µ','ç´”è³‡ç”£','å–¶æ¥­è²»ç”¨','è²©å£²è²»ãŠã‚ˆã³ä¸€èˆ¬ç®¡ç†è²»','å–¶æ¥­å¤–è²»ç”¨','ç‰¹åˆ¥æå¤±','å–¶æ¥­åç›Š','å–¶æ¥­å¤–åç›Š','ç‰¹åˆ¥åˆ©ç›Š','ãã®ä»–'];
  const TYPE_TO_GROUP = new Map([
    ['æµå‹•è³‡ç”£','asset'], ['å›ºå®šè³‡ç”£','asset'],['æµå‹•è² å‚µ','liab'], ['å›ºå®šè² å‚µ','liab'],['ç´”è³‡ç”£','equity'],
    ['å–¶æ¥­è²»ç”¨','exp'], ['è²©å£²è²»ãŠã‚ˆã³ä¸€èˆ¬ç®¡ç†è²»','exp'], ['å–¶æ¥­å¤–è²»ç”¨','exp'],['å–¶æ¥­åç›Š','rev'], ['å–¶æ¥­å¤–åç›Š','rev'],['ãã®ä»–','other']
  ]);
  const GROUP_TO_BTNCLASS = { asset: 'btn-asset', liab: 'btn-liab', equity:'btn-equity', exp: 'btn-exp', rev: 'btn-rev', other:'btn-other' };
  
  let allItems = [], items = [], deck = [], deckIndex = 0, current = null, answered = false;
  let count = 0, correct = 0, lap = 0;

  // --- â˜… è‹¦æ‰‹ãƒªã‚¹ãƒˆæ©Ÿèƒ½ ---
  function loadMistakes(){
    const saved = localStorage.getItem('bokiApp_mistakes');
    if(saved) mistakeList = JSON.parse(saved);
    updateMistakeBtn();
  }
  function saveMistakes(){
    localStorage.setItem('bokiApp_mistakes', JSON.stringify(mistakeList));
    updateMistakeBtn();
  }
  function addMistake(item){
    // ã™ã§ã«ãƒªã‚¹ãƒˆã«ã‚ã‚‹ã‹ç¢ºèªï¼ˆé‡è¤‡å›é¿ï¼‰
    const exists = mistakeList.some(m => m.name === item.name);
    if(!exists){
      mistakeList.push({ name: item.name, type: item.type });
      saveMistakes();
    }
  }
  function removeMistake(name){
    mistakeList = mistakeList.filter(m => m.name !== name);
    saveMistakes();
    renderMistakeList(); // ãƒªã‚¹ãƒˆå†æç”»
  }
  function updateMistakeBtn(){
    const btn = document.getElementById('mistakeBtn');
    const countSpan = document.getElementById('mistakeCount');
    countSpan.textContent = mistakeList.length;
    if(mistakeList.length > 0) {
      btn.style.display = "inline-block";
    } else {
      btn.style.display = "none";
    }
  }
  function openMistakeModal(){
    renderMistakeList();
    document.getElementById('mistakeModal').style.display = 'block';
  }
  function closeMistakeModal(){
    document.getElementById('mistakeModal').style.display = 'none';
  }
  function renderMistakeList(){
    const container = document.getElementById('mistakeListContainer');
    container.innerHTML = "";
    if(mistakeList.length === 0){
      container.innerHTML = "<div style='text-align:center; padding:20px;'>è‹¦æ‰‹ãƒªã‚¹ãƒˆã¯ç©ºã§ã™ï¼å®Œç’§ï¼ğŸ‰</div>";
      return;
    }
    mistakeList.forEach(m => {
      const div = document.createElement('div');
      div.className = 'mistake-item';
      div.innerHTML = `
        <div>
          <span class="m-name">${m.name}</span>
          <span class="m-ans">æ­£è§£ï¼š${m.type}</span>
        </div>
        <button class="del-btn" onclick="removeMistake('${m.name}')">å‰Šé™¤</button>
      `;
      container.appendChild(div);
    });
  }
  // -----------------------

  function lockNameTry() {
    const input = document.getElementById('playerName');
    if(input.value.trim()) {
      playerName = input.value.trim();
      localStorage.setItem('bokiApp_playerName', playerName);
      input.readOnly = true; 
    }
  }
  function resetAllData() {
    if(!confirm("æœ¬å½“ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nãƒ¬ãƒ™ãƒ«ã‚‚è‹¦æ‰‹ãƒªã‚¹ãƒˆã‚‚å…¨ã¦æ¶ˆãˆã¾ã™ã€‚")) return;
    localStorage.clear();
    location.reload();
  }
  function loadProgress() {
    const s = localStorage.getItem('bokiApp_totalCorrect');
    if (s) totalCorrectAccumulated = parseInt(s, 10);
    const n = localStorage.getItem('bokiApp_playerName');
    if (n) {
      playerName = n;
      document.getElementById('playerName').value = n;
      document.getElementById('playerName').readOnly = true;
    }
    loadMistakes(); // è‹¦æ‰‹ãƒªã‚¹ãƒˆèª­ã¿è¾¼ã¿
  }
  function saveProgress() {
    localStorage.setItem('bokiApp_totalCorrect', totalCorrectAccumulated);
  }
  function updateCharacterUI() {
    let chara = CHARACTERS[0];
    for(let c of CHARACTERS){ if(totalCorrectAccumulated >= c.score) chara = c; }
    currentCharacter = chara;
    document.getElementById('charIcon').textContent = chara.icon;
    document.getElementById('charName').textContent = chara.name;
    document.getElementById('totalAccumulated').textContent = totalCorrectAccumulated;
    
    // æ¬¡ã®ãƒ¬ãƒ™ãƒ«
    const idx = CHARACTERS.indexOf(chara);
    if(idx < CHARACTERS.length - 1){
       document.getElementById('charNext').textContent = `ã‚ã¨ ${CHARACTERS[idx+1].score - totalCorrectAccumulated} å•ã§é€²åŒ–`;
    } else {
       document.getElementById('charNext').textContent = "Max Level";
    }
  }
  
  // UIç›£è¦–ï¼ˆã‚¢ãƒ³ãƒãƒãƒ¼ãƒˆï¼‰
  setInterval(() => {
    if(document.getElementById('totalAccumulated').textContent != totalCorrectAccumulated)
       document.getElementById('totalAccumulated').textContent = totalCorrectAccumulated;
    if(document.getElementById('charName').textContent !== currentCharacter.name)
       document.getElementById('charName').textContent = currentCharacter.name;
  }, 1000);

  function normalizeType(s){ return String(s ?? '').replace(/\s+/g,' ').trim(); }
  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }
  function showQuizUI(){
    document.getElementById("stageClear").style.display = "none";
    document.getElementById("quizArea").style.display = "block";
    document.getElementById("buttons").style.display = "grid";
  }
  function showClearUI(){
    document.getElementById("quizArea").style.display = "none";
    document.getElementById("buttons").style.display = "none";
    document.getElementById("stageClear").style.display = "block";
    document.getElementById("scCorrect").textContent = String(correct);
    document.getElementById("scCount").textContent = String(count);
    document.getElementById("lapMsg").textContent = `${lap}å‘¨ç›®ã‚¯ãƒªã‚¢ï¼`;
  }
  function prepareDeck(){
    deck = [...items]; shuffle(deck); deckIndex = 0; lap++;
    document.getElementById('lap').textContent = String(lap);
    updateRemain();
  }
  function startNextLap(){
    showQuizUI(); document.getElementById("result").textContent = "";
    prepareDeck(); next();
  }
  function updateRemain(){
    document.getElementById('remain').textContent = String(Math.max(0, deck.length - deckIndex));
  }
  function show(item){
    current = item; answered = false;
    document.getElementById("account").textContent = item ? item.name : "â€”";
    document.getElementById("result").textContent = "";
  }
  function answer(type){
    if (!current || answered) return;
    if(!playerName) { alert("åå‰ã‚’å…¥ã‚Œã¦ã­ï¼"); return; }
    
    answered = true; count++;
    const ok = (type === current.type);
    
    if (ok) {
      correct++; totalCorrectAccumulated++;
      saveProgress(); updateCharacterUI();
      document.getElementById("result").innerHTML = `<span class="ok">â­• æ­£è§£ï¼</span>`;
    } else {
      // â˜… ä¸æ­£è§£ãªã‚‰è‹¦æ‰‹ãƒªã‚¹ãƒˆã«è¿½åŠ 
      addMistake(current);
      document.getElementById("result").innerHTML = `<span class="ng">âŒ ä¸æ­£è§£...</span><span class="muted small">æ­£è§£ã¯ ${current.type}</span>`;
    }
    
    document.getElementById("count").textContent = count;
    document.getElementById("correct").textContent = correct;

    setTimeout(() => { if (deckIndex < deck.length) next(); else next(); }, ok ? 600 : 1500);
  }
  function next(){
    if (!deck.length) return;
    if (deckIndex >= deck.length) { showClearUI(); return; }
    show(deck[deckIndex]); deckIndex++; updateRemain();
  }
  function buildButtons(typeList){
    const wrap = document.getElementById('buttons'); wrap.innerHTML = '';
    typeList.forEach(t => {
      const btn = document.createElement('button');
      btn.className = 'typeBtn ' + (GROUP_TO_BTNCLASS[TYPE_TO_GROUP.get(t)||'other']||'btn-other');
      btn.textContent = t; btn.onclick = () => answer(t);
      wrap.appendChild(btn);
    });
  }
  function loadDataFromString() {
    const lines = RAW_CSV_DATA.split(/\r?\n/).filter(l => l.trim());
    lines.shift(); // header
    allItems = lines.map(l=>{
      const c = l.split(','); return { name:c[0].trim(), type:normalizeType(c[1]) };
    });
    const types = [...new Set(allItems.map(x=>x.type))]; // ç°¡æ˜“ã‚½ãƒ¼ãƒˆãªã—
    // ç°¡æ˜“çš„ã«å…¨ãƒœã‚¿ãƒ³ç”Ÿæˆ
    const fixedTypes = ['æµå‹•è³‡ç”£','å›ºå®šè³‡ç”£','æµå‹•è² å‚µ','å›ºå®šè² å‚µ','ç´”è³‡ç”£','å–¶æ¥­è²»ç”¨','è²©å£²è²»ãŠã‚ˆã³ä¸€èˆ¬ç®¡ç†è²»','å–¶æ¥­å¤–è²»ç”¨','å–¶æ¥­åç›Š','å–¶æ¥­å¤–åç›Š','ãã®ä»–'];
    buildButtons(fixedTypes);
    
    // ãƒ•ã‚£ãƒ«ã‚¿ãªã©ã®åˆæœŸåŒ–ã¯çœç•¥ï¼ˆå…¨ä»¶ãƒ¢ãƒ¼ãƒ‰ï¼‰
    items = allItems;
    startNextLap();
  }

  (function init(){
    loadProgress();
    loadDataFromString();
    updateCharacterUI();
  })();
</script>
</body>
</html>
